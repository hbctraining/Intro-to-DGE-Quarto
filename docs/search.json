[
  {
    "objectID": "lessons/01a_RNAseq_processing_workflow.html",
    "href": "lessons/01a_RNAseq_processing_workflow.html",
    "title": "From raw sequence reads to count matrix",
    "section": "",
    "text": "Approximate time: 40 minutes",
    "crumbs": [
      "Pre-reading:",
      "From raw sequence reads to count matrix"
    ]
  },
  {
    "objectID": "lessons/01a_RNAseq_processing_workflow.html#learning-objectives",
    "href": "lessons/01a_RNAseq_processing_workflow.html#learning-objectives",
    "title": "From raw sequence reads to count matrix",
    "section": "Learning Objectives",
    "text": "Learning Objectives\n\nUnderstand the different steps of the RNA-seq workflow, from RNA extraction to assessing the expression levels of genes.",
    "crumbs": [
      "Pre-reading:",
      "From raw sequence reads to count matrix"
    ]
  },
  {
    "objectID": "lessons/01a_RNAseq_processing_workflow.html#rna-extraction-and-library-preparation",
    "href": "lessons/01a_RNAseq_processing_workflow.html#rna-extraction-and-library-preparation",
    "title": "From raw sequence reads to count matrix",
    "section": "1. RNA extraction and library preparation",
    "text": "1. RNA extraction and library preparation\nBefore RNA can be sequenced, it must first be extracted and separated from its cellular environment and prepared into a cDNA library. There are a number of steps involved which are outlined in the figure below, and in parallel there are various quality checks implemented to make sure we have good quality RNA to move forward with. We briefly describe some of these steps below.\na. Enriching for RNA. Once the sample has been treated with DNAse to remove any contaminating DNA sequence, the sample undergoes either selection of the mRNA (polyA selection) or depletion of the rRNA.\nGenerally, ribosomal RNA represents the majority of the RNAs present in a cell, while messenger RNAs represent a small percentage of total RNA (~2% in humans). Therefore, if we want to study the protein-coding genes, we need to enrich for mRNA or deplete the rRNA. For differential gene expression analysis, it is best to enrich for Poly(A)+, unless you are aiming to obtain information about long non-coding RNAs, in which case ribosomal RNA depletion is recommended.\n\n\n\n\n\n\nRNA Quality check\n\n\n\nIt is essential to check for the integrity of the extracted RNA prior to starting the cDNA library prepation. Traditionally, RNA integrity was assessed via gel electrophoresis by visual inspection of the ribosomal RNA bands, but that method is time-consuming and imprecise. The Bioanalyzer system from Agilent will rapidly assess RNA integrity and calculate an RNA Integrity Number (RIN), which facilitates the interpretation and reproducibility of RNA quality. RIN, essentially, provides a means by which RNA quality from different samples can be compared to each other in a standardized manner.\n\n\nb. Fragmentation and size selection. The remaining RNA molecules are then fragmented. This is done either via chemical, enzymatic (e.g., RNAses), or physical processes (e.g., chemical/mechanical shearing). These fragments then undergo size selection to retain only those fragments within a size range that Illumina sequencing machines can handle best, i.e., between 150 to 300 bp.\n\n\n\n\n\n\nFragment size quality check\n\n\n\nAfter size selection/exclusion, the fragment size distribution should be assesed to ensure that it is unimodal and well-defined.\n\n\nc. Reverse transcribe RNA into double-stranded cDNA. Information about which strand a fragment originated from can be preserved by creating stranded libraries. The most commonly used method incorporates deoxy-UTP during the synthesis of the second cDNA strand (Levin JZ et al., 2010). Once double-stranded cDNA fragments are generated, sequence adapters are ligated to the ends. (Size selection can be performed here instead of at the RNA level.)\nd. PCR amplification. If the amount of starting material is low and/or to increase the number of cDNA molecules to an amount sufficient for sequencing, libraries are usually PCR amplified. Run as few amplification cycles as possible to avoid PCR artefacts.\n\n\n\nImage source: Zeng W and Mortazavi A, 2012",
    "crumbs": [
      "Pre-reading:",
      "From raw sequence reads to count matrix"
    ]
  },
  {
    "objectID": "lessons/01a_RNAseq_processing_workflow.html#sequencing-illumina",
    "href": "lessons/01a_RNAseq_processing_workflow.html#sequencing-illumina",
    "title": "From raw sequence reads to count matrix",
    "section": "2. Sequencing (Illumina)",
    "text": "2. Sequencing (Illumina)\nSequencing of the cDNA libraries will generate reads. Reads correspond to the nucleotide sequences of the ends of each of the cDNA fragements in the library. You will have the choice of sequencing either a single end of the cDNA fragments (single-end reads) or both ends of the fragments (paired-end reads).\n\n\n\n\nSE - Single end dataset =&gt; Only Read1\nPE - Paired-end dataset =&gt; Read1 + Read2\n\ncan be 2 separate FastQ files or just one with interleaved pairs\n\n\nGenerally single-end sequencing is sufficient unless it is expected that the reads will match multiple locations on the genome (e.g. organisms with many paralogous genes), assemblies are being performed, or for splice isoform differentiation. Be aware that paired-end reads are generally 2x more expensive.\n\nSequencing-by-synthesis\nIllumina sequencing technology uses a sequencing-by-synthesis approach. To explore sequencing by synthesis in more depth, please watch this linked video on Illumina’s YouTube channel.\nWe have privided a brief explanation of the steps below:\nCluster growth: The DNA fragments in the cDNA library are denatured and hybridized to the glass flowcell (adapter complementarity). Each fragment is then clonally amplified, forming a cluster of double-stranded DNA. This step is necessary to ensure that the sequencing signal will be strong enough to be detected/captured unambiguously for each base of each fragment.\n\nNumber of clusters ~= Number of reads\n\nSequencing: The sequencing of the fragment ends is based on fluorophore-labelled dNTPs with reversible terminator elements. In each sequencing cycle, a base is incorporated into every cluster and excited by a laser.\nImage acquisition: Each dNTP has a distinct excitatory signal emission that is captured by cameras.\nBase calling: The Base calling program will then generate the sequence of bases, i.e. reads, for each fragement/cluster by assessing the images captured during the many sequencing cycles. In addition to calling the base in every position, the base caller will also report the certainty with which it was able to make the call (quality information).\n\nNumber of sequencing cycles = Length of reads",
    "crumbs": [
      "Pre-reading:",
      "From raw sequence reads to count matrix"
    ]
  },
  {
    "objectID": "lessons/01a_RNAseq_processing_workflow.html#quality-control-of-raw-sequencing-data-fastqc",
    "href": "lessons/01a_RNAseq_processing_workflow.html#quality-control-of-raw-sequencing-data-fastqc",
    "title": "From raw sequence reads to count matrix",
    "section": "3. Quality control of raw sequencing data (FastQC)",
    "text": "3. Quality control of raw sequencing data (FastQC)\nThe raw reads obtained from the sequencer are stored as FASTQ files. The FASTQ file format is the de facto file format for sequence reads generated from next-generation sequencing technologies.\nEach FASTQ file is a text file that represents sequence readouts for a sample. Each read is represented by 4 lines as shown below:\n@HWI-ST330:304:H045HADXX:1:1101:1111:61397\nCACTTGTAAGGGCAGGCCCCCTTCACCCTCCCGCTCCTGGGGGANNNNNNNNNNANNNCGAGGCCCTGGGGTAGAGGGNNNNNNNNNNNNNNGATCTTGG\n+\n@?@DDDDDDHHH?GH:?FCBGGB@C?DBEGIIIIAEF;FCGGI#########################################################\n\n\n\n\n\n\n\nLine\nDescription\n\n\n\n\n1\nAlways begins with ‘@’ and then information about the read\n\n\n2\nThe actual DNA sequence\n\n\n3\nAlways begins with a ‘+’ and sometimes the same info as in line 1\n\n\n4\nHas a string of characters which represent the quality scores; must have same number of characters as line 2\n\n\n\nFastQC is a commonly used software that provides a simple way to do some quality control checks on raw sequence data.\nThe main functions include:\n\nProviding a quick overview to tell you in which areas there may be problems\nSummary graphs and tables to quickly assess your data\nExport of results to an HTML-based permanent report",
    "crumbs": [
      "Pre-reading:",
      "From raw sequence reads to count matrix"
    ]
  },
  {
    "objectID": "lessons/01a_RNAseq_processing_workflow.html#quantify-expression",
    "href": "lessons/01a_RNAseq_processing_workflow.html#quantify-expression",
    "title": "From raw sequence reads to count matrix",
    "section": "4. Quantify expression",
    "text": "4. Quantify expression\nOnce we have explored the quality of our raw reads, we can move on to quantifying expression at the transcript level. The goal of this step is to identify from which transcript each of the reads originated from and the total number of reads associated with each transcript.\nTools that have been found to be most accurate for this step in the analysis are referred to as lightweight alignment tools, which include:\n\nKallisto,\nSailfish and\nSalmon\n\nEach of the tools in the list above work slightly differently from one another. However, common to all of them is that they avoid base-to-base genomic alignment of the reads. Genomic alignment is a step performed by older splice-aware alignment tools such as STAR and HISAT2. In comparison to these tools, the lightweight alignment tools not only provide quantification estimates faster (typically more than 20 times faster), but also prove improvements in accuracy (Robert C and Watson M, 2015).\nWe will use the expression estimates, often referred to as ‘pseudocounts’, obtained from Salmon as the starting point for the differential gene expression analysis.",
    "crumbs": [
      "Pre-reading:",
      "From raw sequence reads to count matrix"
    ]
  },
  {
    "objectID": "lessons/01a_RNAseq_processing_workflow.html#quality-control-of-aligned-sequence-reads-starqualimap",
    "href": "lessons/01a_RNAseq_processing_workflow.html#quality-control-of-aligned-sequence-reads-starqualimap",
    "title": "From raw sequence reads to count matrix",
    "section": "5. Quality control of aligned sequence reads (STAR/Qualimap)",
    "text": "5. Quality control of aligned sequence reads (STAR/Qualimap)\nAs mentioned above, the differential gene expression analysis will use transcript/gene pseudocounts generated by Salmon. However, to perform some basic quality checks on the sequencing data, it is important to align the reads to the whole genome. Either STAR or HiSAT2 are able to perform this step and generate a BAM file that can be used for QC.\nA tool called Qualimap explores the features of aligned reads in the context of the genomic region they map to, hence providing an overall view of the data quality (as an HTML file). Various quality metrics assessed by Qualimap include:\n\nDNA or rRNA contamination\n5’-3’ biases\nCoverage biases",
    "crumbs": [
      "Pre-reading:",
      "From raw sequence reads to count matrix"
    ]
  },
  {
    "objectID": "lessons/01a_RNAseq_processing_workflow.html#quality-control-aggregating-results-with-multiqc",
    "href": "lessons/01a_RNAseq_processing_workflow.html#quality-control-aggregating-results-with-multiqc",
    "title": "From raw sequence reads to count matrix",
    "section": "6. Quality control: aggregating results with MultiQC",
    "text": "6. Quality control: aggregating results with MultiQC\nThroughout the workflow we have performed various steps of quality checks on our data. You will need to do this for every sample in your dataset, making sure these metrics are consistent across the samples for a given experiment. Outlier samples should be flagged for further investigation and potential removal.\nManually tracking these metrics and browsing through multiple HTML reports (FastQC, Qualimap) and log files (Salmon, STAR) for each samples is tedious and prone to errors. MultiQC is a tool that aggregates results from several tools and generates a single HTML report with plots to visualize and compare various QC metrics between the samples. Assessment of the QC metrics may result in the removal of samples before proceeding to the next step, if necessary.\n\nOnce the QC has been performed on all the samples, we are ready to get started with Differential Gene Expression analysis with DESeq2!",
    "crumbs": [
      "Pre-reading:",
      "From raw sequence reads to count matrix"
    ]
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "",
    "section": "",
    "text": "Code\n\n\n\n\n\nIntroduction to Differential Gene Expression Analysis\n\n\n\nAudience\nComputational skills required\nDuration\n\n\n\n\nBiologists\nIntroduction to R\n4-session online workshop (~8 hours of trainer-led time)\n\n\n\n\nDescription\nThis repository has teaching materials for a hands-on Introduction to Differential Gene Expression Analysis workshop. The workshop will lead participants through performing a differential gene expression analysis workflow on RNA-seq count data using R/RStudio. Working knowledge of R is required or completion of the Introduction to R workshop.\nNote for Trainers: Please note that the schedule linked below assumes that learners will spend between 3-4 hours on reading through, and completing exercises from selected lessons between classes. The online component of the workshop focuses on more exercises and discussion/Q & A.\n\n\n\n\n\n\nNote\n\n\n\nThese materials were developed for a trainer-led workshop, but are also amenable to self-guided learning.\n\n\n\n\nLearning Objectives\n\nQC on count data using Principal Component Analysis (PCA) and hierarchical clustering\nUsing DESeq2 to obtain a list of significantly different genes\nVisualizing expression patterns of differentially expressed genes\nPerforming functional analysis on gene lists with R-based tools\n\n\n\nLessons\n\nWorkshop schedule (trainer-led learning)\nSelf-learning\n\n\n\nInstallation Requirements\n\nApplications\nDownload the most recent versions of R and RStudio for your laptop:\n\nR (version 4.0.0 or above)\nRStudio\n\n\n\nPackages for R\n\n\n\n\n\n\nNotes\n\n\n\nNote 1: Install the packages in the order listed below.\nNote 2:  All the package names listed below are case sensitive!\nNote 3: If you have a Mac with an M1 chip, download and install this tool before installing your packages: https://mac.r-project.org/tools/gfortran-12.2-universal.pkg\nNote 4: At any point (especially if you’ve used R/Bioconductor in the past), in the console R may ask you if you want to update any old packages by asking Update all/some/none? [a/s/n]:. If you see this, type “a” at the prompt and hit Enter to update any old packages. Updating packages can sometimes take quite a bit of time to run, so please account for that before you start with these installations.\nNote 5: If you see a message in your console along the lines of “binary version available but the source version is later”, followed by a question, “Do you want to install from sources the package which needs compilation? y/n”, type n for no, and hit enter.\n\n\n(1) Install the 6 packages listed below from CRAN using the install.packages() function. You DO NOT have to go to the CRAN webpage; you can use the following function to install them one by one.\n\nBiocManager\ntidyverse\nRColorBrewer\npheatmap\nggrepel\ncowplot\n\nPlease install them one-by-one as follows:\n\ninstall.packages(\"BiocManager\")\ninstall.packages(\"tidyverse\")\n# & so on ...\n\n(2) Install the 10 packages listed below from Bioconductor using the the BiocManager::install() function.\n\nDESeq2\nclusterProfiler\nDOSE\norg.Hs.eg.db\npathview\nDEGreport\ntximport\nAnnotationHub\nensembldb\napeglm\n\n\n\n\n\n\n\nNote\n\n\n\nNOTE: The library used for the annotations associated with genes (here we are using org.Hs.eg.db) will change based on organism (e.g. if studying mouse, would need to install and load org.Mm.eg.db). The list of different organism packages are given here.\n\n\nPlease install them one-by-one as follows:\n\nBiocManager::install(\"DESeq2\")\nBiocManager::install(\"clusterProfiler\")\n# & so on ...\n\n(3) Finally, please check that all the packages were installed successfully by loading them one at a time using the library() function.\n\nlibrary(DESeq2)\nlibrary(tidyverse)\nlibrary(RColorBrewer)\nlibrary(pheatmap)\nlibrary(ggrepel)\nlibrary(cowplot)\nlibrary(clusterProfiler)\nlibrary(DEGreport)\nlibrary(org.Hs.eg.db)\nlibrary(DOSE)\nlibrary(pathview)\nlibrary(tximport)\nlibrary(AnnotationHub)\nlibrary(ensembldb)\nlibrary(apeglm)\n\n(4) Once all packages have been loaded, run sessionInfo().\n\nsessionInfo()\n\n\n\n\n\nCitation\nTo cite material from this course in your publications, please use:\n\n\n\n\n\n\nCitation\n\n\n\nMeeta Mistry, Mary Piper, Jihe Liu, & Radhika Khetani. (2021, May 24). hbctraining/DGE_workshop_salmon_online: Differential Gene Expression Workshop Lessons from HCBC (first release). Zenodo. https://doi.org/10.5281/zenodo.4783481. RRID:SCR_025373.\n\n\nA lot of time and effort went into the preparation of these materials. Citations help us understand the needs of the community, gain recognition for our work, and attract further funding to support our teaching activities. Thank you for citing this material if it helped you in your data analysis."
  },
  {
    "objectID": "lessons/experimental_planning_considerations.html",
    "href": "lessons/experimental_planning_considerations.html",
    "title": "Experimental design considerations",
    "section": "",
    "text": "Approximate time: 50 minutes",
    "crumbs": [
      "Pre-reading:",
      "Experimental design considerations"
    ]
  },
  {
    "objectID": "lessons/experimental_planning_considerations.html#learning-objectives",
    "href": "lessons/experimental_planning_considerations.html#learning-objectives",
    "title": "Experimental design considerations",
    "section": "Learning Objectives:",
    "text": "Learning Objectives:\n\nDescribe the importance of replicates for RNA-seq differential expression experiments\nExplain the relationship between the number of biological replicates, sequencing depth, and the differentially expressed genes identified\nDemonstrate how to design an RNA-seq experiment that avoids confounding and batch effects",
    "crumbs": [
      "Pre-reading:",
      "Experimental design considerations"
    ]
  },
  {
    "objectID": "lessons/experimental_planning_considerations.html#replicates",
    "href": "lessons/experimental_planning_considerations.html#replicates",
    "title": "Experimental design considerations",
    "section": "Replicates",
    "text": "Replicates\nExperimental replicates can be performed as technical replicates or biological replicates.\n\nImage credit: Klaus B, 2015\n\nTechnical replicates: use the same biological sample to repeat the technical or experimental steps in order to accurately measure technical variation and remove it during analysis.\nBiological replicates use different biological samples of the same condition to measure the biological variation between samples.\n\nIn the days of microarrays, technical replicates were considered a necessity; however, with the current RNA-seq technologies, technical variation is much lower than biological variation and technical replicates are unneccessary.\nIn contrast, biological replicates are absolutely essential for differential expression analysis. For mice or rats, this might be easy to determine what constitutes a different biological sample, but it’s a bit more difficult to determine for cell lines. This article gives some great recommendations for cell line replicates.\nFor differential expression analysis, the more biological replicates, the better the estimates of biological variation and the more precise our estimates of the mean expression levels. This leads to more accurate modeling of our data and identification of more differentially expressed genes.\n\nImage credit: Liu Y et al., 2014\nAs the figure above illustrates, biological replicates are of greater importance than sequencing depth, which is the total number of reads sequenced per sample. The figure shows the relationship between sequencing depth and number of replicates on the number of differentially expressed genes identified [1]. Note that an increase in the number of replicates tends to return more DE genes than increasing the sequencing depth. Therefore, generally more replicates are better than higher sequencing depth, with the caveat that higher depth is required for detection of lowly expressed DE genes and for performing isoform-level differential expression.\n\n\n\n\n\n\nSample pooling\n\n\n\nTry to avoid pooling of individuals/experiments, if possible; however, if absolutely necessary, then each pooled set of samples would count as a single replicate. To ensure similar amounts of variation between replicates, you would want to pool the same number of individuals for each pooled set of samples.\nFor example, if you need at least 3 individuals to get enough material for your control replicate and at least 5 individuals to get enough material for your treatment replicate, you would pool 5 individuals for the control and 5 individuals for the treatment condition. You would also make sure that the individuals that are pooled in both conditions are similar in sex, age, etc.\n\n\nReplicates are almost always preferred to greater sequencing depth for bulk RNA-seq. However, guidelines depend on the experiment performed and the desired analysis. Below we list some general guidelines for replicates and sequencing depth to help with experimental planning:\n\nGeneral gene-level differential expression:\n\nENCODE guidelines suggest 30 million SE reads per sample (stranded).\n15 million reads per sample is often sufficient, if there are a good number of replicates (&gt;3).\nSpend money on more biological replicates, if possible.\nGenerally recommended to have read length &gt;= 50 bp.\n\nGene-level differential expression with detection of lowly-expressed genes:\n\nSimilarly benefits from replicates more than sequencing depth.\nSequence deeper with at least 30-60 million reads depending on level of expression (start with 30 million with a good number of replicates).\nGenerally recommended to have read length &gt;= 50 bp.\n\nIsoform-level differential expression:\n\nFor known isoforms, suggested to have a depth of at least 30 million reads per sample and paired-end reads.\nFor novel isoforms, should have more depth (&gt; 60 million reads per sample).\nChoose biological replicates over paired/deeper sequencing.\nGenerally recommended to have read length &gt;= 50 bp, but longer is better as the reads will be more likely to cross exon junctions.\nPerform careful QC of RNA quality. Be careful to use high quality preparation methods and restrict analysis to high quality RIN # samples.\n\nOther types of RNA analyses (intron retention, small RNA-Seq, etc.):\n\nDifferent recommendations depending on the analysis.\nAlmost always more biological replicates are better!\n\n\n\n\n\n\n\n\nNote\n\n\n\nThe factor used to estimate the depth of sequencing for genomes is “coverage” - how many times do the number of nucleotides sequenced “cover” the genome. This metric is not exact for genomes (whole genome sequencing), but it is good enough and is used extensively. However, the metric does not work for transcriptomes because even though you may know what % of the genome has transcriptional activity, the expression of the genes is highly variable.",
    "crumbs": [
      "Pre-reading:",
      "Experimental design considerations"
    ]
  },
  {
    "objectID": "lessons/experimental_planning_considerations.html#confounding",
    "href": "lessons/experimental_planning_considerations.html#confounding",
    "title": "Experimental design considerations",
    "section": "Confounding",
    "text": "Confounding\nA confounded RNA-seq experiment is one where you cannot distinguish the separate effects of two different sources of variation in the data.\nFor example, we know that sex has large effects on gene expression, and if all of our control mice were female and all of the treatment mice were male, then our treatment effect would be confounded by sex. We could not differentiate the effect of treatment from the effect of sex.\n\nTo AVOID confounding:\n\nEnsure animals in each condition are all the same sex, age, litter, and batch, if possible.\nIf not possible, then ensure to split the animals equally between conditions",
    "crumbs": [
      "Pre-reading:",
      "Experimental design considerations"
    ]
  },
  {
    "objectID": "lessons/experimental_planning_considerations.html#batch-effects",
    "href": "lessons/experimental_planning_considerations.html#batch-effects",
    "title": "Experimental design considerations",
    "section": "Batch effects",
    "text": "Batch effects\nBatch effects are a significant issue for RNA-seq analyses, since you can see significant differences in expression due solely to the batch effect.\n\nImage credit: Hicks SC et al., 2015\nThe issues generated by poor batch study design are highlighted nicely in Gilad Y & Mizrahi-Man O, 2015.\n\nHow to know whether you have batches?\n\nWere all RNA isolations performed on the same day?\nWere all library preparations performed on the same day?\nDid the same person perform the RNA isolation/library preparation for all samples?\nDid you use the same reagents for all samples?\nDid you perform the RNA isolation/library preparation in the same location?\n\nIf any of the answers is ‘No’, then you have batches.\n\n\nBest practices regarding batches:\n\nDesign the experiment in a way to avoid batches, if possible.\nIf unable to avoid batches:\n\nDo NOT confound your experiment by batch:\n\nImage credit: Hicks SC et al., 2015\nDO split replicates of the different sample groups across batches. The more replicates, the better (definitely more than 2).\n\nImage credit: Hicks SC et al., 2015\nDO include batch information in your experimental metadata. During the analysis, we can regress out the variation due to batch if not confounded so it doesn’t affect our results – if we have that information.\n\n\n\n\n\n\n\n\n\nNote\n\n\n\nThe sample preparation of cell line “biological” replicates “should be performed as independently as possible” (as batches), “meaning that cell culture media should be prepared freshly for each experiment, different frozen cell stocks and growth factor batches, etc. should be used [2].” However, preparation across all conditions should be performed at the same time.\n\n\n\n\n\n\n\n\n\nExercise\n\n\n\nYour experiment has three different treatment groups, A, B, and C. Due to the lengthy process of tissue extraction, you can only isolate the RNA from two samples at the same time. You plan to have 4 replicates per group. Your metadata table is as follows:\n\n\n\nsample\ntreatment\nsex\nreplicate\nRNA isolation\n\n\n\n\nsample1\nA\nF\n1\n\n\n\nsample2\nA\nF\n2\n\n\n\nsample3\nA\nM\n3\n\n\n\nsample4\nA\nM\n4\n\n\n\nsample5\nB\nF\n1\n\n\n\nsample6\nB\nF\n2\n\n\n\nsample7\nB\nM\n3\n\n\n\nsample8\nB\nM\n4\n\n\n\nsample9\nC\nF\n1\n\n\n\nsample10\nC\nF\n2\n\n\n\nsample11\nC\nM\n3\n\n\n\nsample12\nC\nM\n4\n\n\n\n\nClick here to download the above table as an Excel file.\n\nFill in the RNA isolation column of the metadata table. Since we can only prepare 2 samples at a time and we have 12 samples total, you will need to isolate RNA in 6 batches. In the RNA isolation column, enter one of the following values for each sample: group1, group2, group3, group4, group5, group6. Make sure to fill in the table so as to avoid confounding by batch of RNA isolation.\nBONUS: To perform the RNA isolations more quickly, you devote two researchers to perform the RNA isolations. Create a researcher column and fill in the researchers’ initials for the samples they will prepare: use initials AB or CD.\n\nAnswer Key",
    "crumbs": [
      "Pre-reading:",
      "Experimental design considerations"
    ]
  },
  {
    "objectID": "lessons/01b_DGE_setup_and_overview.html",
    "href": "lessons/01b_DGE_setup_and_overview.html",
    "title": "Set up and overview for gene-level differential expression analysis",
    "section": "",
    "text": "Approximate time: 60 minutes",
    "crumbs": [
      "Day 1:",
      "Set up and overview for gene-level differential expression analysis"
    ]
  },
  {
    "objectID": "lessons/01b_DGE_setup_and_overview.html#learning-objectives",
    "href": "lessons/01b_DGE_setup_and_overview.html#learning-objectives",
    "title": "Set up and overview for gene-level differential expression analysis",
    "section": "Learning Objectives",
    "text": "Learning Objectives\n\nDescribe the RNA-seq and differential gene expression analysis workflows\nExplain the experiment and its objectives\nCreate a project in R\nSet up for the analysis of RNA-seq data",
    "crumbs": [
      "Day 1:",
      "Set up and overview for gene-level differential expression analysis"
    ]
  },
  {
    "objectID": "lessons/01b_DGE_setup_and_overview.html#review-of-the-dataset",
    "href": "lessons/01b_DGE_setup_and_overview.html#review-of-the-dataset",
    "title": "Set up and overview for gene-level differential expression analysis",
    "section": "Review of the dataset",
    "text": "Review of the dataset\nFor this workshop, we will be using a publicly available RNA-seq dataset that is part of a larger study described in Kenny PJ et al., 2014.\nThe RNA-seq was performed on HEK293F cells that were transfected either with a MOV10 transgene, siRNA to knock down Mov10 expression, or non-specific (irrelevant) siRNA. This resulted in 3 conditions Mov10 oe (over expression), Mov10 kd (knock down) and Irrelevant kd, respectively. The number of replicates is as shown below.\nUsing these data, we will evaluate transcriptional patterns associated with perturbation of MOV10 expression. Please note that the irrelevant siRNA will be treated as our control condition.\n\n\n\n\n\n\n\n\n\nWhat is the purpose of these datasets? What does Mov10 do?\n\n\n\nThe authors are investigating interactions between various genes involved in Fragile X syndrome, a disease in which there is aberrant production of the FMRP protein.\nFMRP, a protein that is “most commonly found in the brain, is essential for normal cognitive development and female reproductive function. Mutations of this gene can lead to fragile X syndrome, intellectual disability, premature ovarian failure, autism, Parkinson’s disease, developmental delays and other cognitive deficits.” - from Wikipedia\nMOV10 is a putative RNA helicase that is also associated with FMRP in the context of the microRNA pathway.\n\n\nThe hypothesis the paper is testing is that FMRP and MOV10 associate and regulate the translation of a subset of RNAs.\n\n\n\nOur questions: * What patterns of expression can we identify with the loss or gain of MOV10? * Are there any genes shared between the two conditions?",
    "crumbs": [
      "Day 1:",
      "Set up and overview for gene-level differential expression analysis"
    ]
  },
  {
    "objectID": "lessons/01b_DGE_setup_and_overview.html#rna-seq-workflow",
    "href": "lessons/01b_DGE_setup_and_overview.html#rna-seq-workflow",
    "title": "Set up and overview for gene-level differential expression analysis",
    "section": "RNA-seq workflow",
    "text": "RNA-seq workflow\nFor this dataset, raw sequence reads were obtained from the Sequence Read Archive (SRA). These reads were then processed using the RNA-seq workflow as detailed in the pre-reading for this workshop. All steps were performed on the command line (Linux/Unix), including a thorough quality control assessment. If you are interested, we have the MultiQC html report for this dataset linked here for you to peruse.\nThe directories of output from the mapping/quantification step of the workflow (Salmon) is the data that we will be using. These transcript abundance estimates, often referred to as ‘pseudocounts’, will be the starting point for our differential gene expression analysis.",
    "crumbs": [
      "Day 1:",
      "Set up and overview for gene-level differential expression analysis"
    ]
  },
  {
    "objectID": "lessons/01b_DGE_setup_and_overview.html#setting-up",
    "href": "lessons/01b_DGE_setup_and_overview.html#setting-up",
    "title": "Set up and overview for gene-level differential expression analysis",
    "section": "Setting up",
    "text": "Setting up\nLet’s get started by opening up RStudio and setting up a new project for this analysis.\n\nGo to the File menu and select New Project.\nIn the New Project window, choose New Directory. Then, choose New Project. Name your new directory DEanalysis and then “Create the project as subdirectory of:” the Desktop (or location of your choice).\nThe new project should automatically open in RStudio.\n\n\n\n\nTo check whether or not you are in the correct working directory, use getwd(). The path Desktop/DEanalysis should be returned to you in the console. Within your working directory, use the New folder button in the bottom right panel to create three new directories: scripts, meta, and results. Remember the key to a good analysis is keeping organized from the start! (NOTE: we will be downloading our data folder.)\nNow we need to grab the files that we will be working with for the analysis. There are two things we need to download.\n\nFirst we need the Salmon results for the full dataset. Right click on the links below, and choose the “Save link as …” option to download directly into your project directory:\n\n\nSalmon data for the Mov10 full dataset\n\nOnce you have the zip file downloaded you will want to decompress it. This will create a data directory with sub-directories that correspond to each of the samples in our dataset.\n\nNext, we need the annotation file that maps our transcript identifiers to gene identifiers. We have created this file for you using the R Bioconductor package AnnotationHub. For now, we will use it as is, but later in the workshop we will spend some time showing you how to create one for yourself. Right click on the links below, and choose the “Save link as …” option to download directly into your project directory, into the data folder.\n\n\nAnnotation file\n\nFinally, go to the File menu and select New File, then select R Script. This should open up a script editor in the top left hand corner. This is where we will be typing and saving all commands required for this analysis. In the script editor, type in header lines:\n\n# HBC RNA-seq DGE workshop\n# Gene-level differential expression analysis using DESeq2\n\nNow save the file as de_script.R within the scripts directory. When finished, your working directory should now look similar to this:\n\n\n\nsetup\n\n\n\nLoading libraries\nFor this analysis we will be using several R packages, some which have been installed from CRAN and others from Bioconductor. To use these packages (and the functions contained within them), we need to load the libraries. Add the following to your script and don’t forget to comment liberally!\n\n# Setup\n# Bioconductor and CRAN libraries used\nlibrary(DESeq2)\nlibrary(tidyverse)\nlibrary(RColorBrewer)\nlibrary(pheatmap)\nlibrary(DEGreport)\nlibrary(tximport)\nlibrary(ggplot2)\nlibrary(ggrepel)\n\n\n\nLoading data\nThe main output of Salmon is a quant.sf file, and we have one of these for each individual sample in our dataset. A screenshot of the file is displayed below:\n\nFor each transcript that was assayed in the reference, we have:\n\nThe transcript identifier\nThe transcript length (in bp)\nThe effective length (described in detail below)\nTPM (transcripts per million), which is computed using the effective length\nThe estimated read count (‘pseudocount’)\n\n\n\n\n\n\n\nWhat exactly is the effective length?\n\n\n\nThe effective length for a transcript is the essentially the number of possible start positions for a read or fragment within that transcript. The sequence composition of a transcript affects how many reads are sampled from it. While two transcripts might be of identical actual length, depending on the sequence composition we are more likely to generate fragments from one versus the other. The transcript that has a higher likelihood of being sampled will end up with the larger effective length. The effective length is transcript length that has been “corrected” to include factors due to sequence-specific and GC biases.\n\n\nWe will be using the R Bioconductor package tximport to prepare the quant.sf files for DESeq2. The first thing we need to do is create a variable that contains the paths to each of our quant.sf files. Then we will add names to our quant files, which will allow us to easily distinguish between samples in the final output matrix.\n\n# List all directories containing data  \nsamples &lt;- list.files(path = \"../data\", full.names = TRUE, pattern = \"salmon$\")\n\n# Obtain a vector of all filenames including the path\nfiles &lt;- file.path(samples, \"quant.sf\")\n\n# Since all quant files have the same name, it is useful to have names for each element\nnames(files) &lt;- str_replace(samples, \"../data/\", \"\") %&gt;% \n                str_replace(\".salmon\", \"\")\n\nOur Salmon index was generated with transcript sequences listed by Ensembl IDs, but tximport needs to know which genes these transcripts came from. We will use the annotation table that we downloaded to extract transcript to gene information.\n\n# Load the annotation table for GrCh38\ntx2gene &lt;- read.delim(\"../data/tx2gene_grch38_ens94.txt\")\n\n# Take a look at it \ntx2gene %&gt;% View()\n\ntx2gene is a three-column data frame linking transcript ID (column 1) to gene ID (column 2) to gene symbol (column 3). We will take the first two columns as input to tximport. The column names are not relevant, but the column order is (i.e., transcript ID must be first).\nNow we are ready to run tximport.\n\n?tximport # let's take a look at the arguments for the tximport function\n\nThe tximport() function imports transcript-level estimates from various external software (e.g., Salmon, Kallisto) and summarizes to the gene-level (default) or outputs transcript-level matrices. There are optional arguments to use the abundance estimates as they appear in the quant.sf files or to calculate alternative values.\nFor our analysis we need non-normalized or “raw” count estimates at the gene-level for performing DESeq2 analysis.\nSince the gene-level count matrix is a default (txOut=FALSE) there is only one additional argument for us to modify to specify how to obtain our “raw” count values. The options for countsFromAbundance are as follows:\n\nno (default): This will take the values in TPM (as our scaled values) and NumReads (as our “raw” counts) columns, and collapse it down to the gene-level.\nscaledTPM: This is taking the TPM scaled up to library size as our “raw” counts.\nlengthScaledTPM: This is used to generate the “raw” count table from the TPM (rather than summarizing the NumReads column). “Raw” count values are generated by using the TPM value x featureLength x library size. These represent quantities that are on the same scale as original counts, except no longer correlated with transcript length across samples.\n\n\n\n\n\n\n\nLet’s review how TPM values are calculated:\n\n\n\n\nDivide the read counts by the length of each gene in kilobases. This gives you reads per kilobase (RPK).\nCount up all the RPK values in a sample and divide this number by 1,000,000. This is your “per million” scaling factor.\nDivide the RPK values by the “per million” scaling factor. This gives you TPM.\n\n\n\n\n# Run tximport\ntxi &lt;- tximport(files, type = \"salmon\", tx2gene = tx2gene[,c(\"tx_id\", \"ensgene\")],\n                countsFromAbundance = \"lengthScaledTPM\")\n\n\n\n\n\n\n\nAn additional argument for tximport\n\n\n\nWhen performing your own analysis, you may find that the reference transcriptome file you obtain from Ensembl will have version numbers included on your identifiers (i.e., ENSG00000265439.2). This will cause a discrepancy with the tx2gene file, since the annotation databases don’t usually contain version numbers (i.e., ENSG00000265439). To get around this issue you can use the argument ignoreTxVersion   = TRUE. The logical value indicates whether to split the tx id on the ‘.’ character to remove version information, for easier matching.\n\n\n\n\nViewing data\nThe txi object is a simple list containing matrices of the abundance, counts, and length. Another list element ‘countsFromAbundance’ carries through the character argument used in the tximport call. The length matrix contains the average transcript length for each gene, which can be used as an offset for gene-level analysis.\n\nattributes(txi)\n\n$names\n[1] \"abundance\"           \"counts\"              \"length\"             \n[4] \"countsFromAbundance\"\n\n\nWe will be using the txi object as is for input into DESeq2, but will save it until the next lesson. For now let’s take a look at the count matrix. You will notice that there are decimal values, so let’s round to the nearest whole number and convert it into a dataframe. We will save it to a variable called data that we can play with.\n\n# Look at the counts\ntxi$counts %&gt;% View()\n\n# Write the counts to an object\ndata &lt;- txi$counts %&gt;% \n  round() %&gt;% \n  data.frame()\n\n\n\n\n\n\n\nWhat if I don’t have Salmon pseudocounts as input?\n\n\n\nUntil recently, the standard approach for RNA-seq analysis had been to map our reads using a splice-aware aligner (e.g., STAR) and then use the resulting BAM files as input to counting tools like featureCounts and htseq-count to obtain our final expression matrix. The field has now moved towards using lightweight alignment tools like Salmon as standard practice. If you are still working with data generated using the older standard approach we have some materials linked here on using DESeq2 with a raw count matrix as your starting point.\n\n\n\n\nCreating metadata\nOf great importance is keeping track of the information about our data. At minimum, we need to at least have a file which maps our samples to the corresponding sample groups that we are investigating. We will use the column headers from the counts matrix as the row names of our metadata file and have a single column to identify each sample as “MOV10_overexpression”, “MOV10_knockdown”, or “control”.\n\n# Create a sample table / metadata\nsampletype &lt;- factor(c(rep(\"control\", 3), rep(\"MOV10_knockdown\", 2), rep(\"MOV10_overexpression\", 3)))\nmeta &lt;- data.frame(sampletype, row.names = colnames(txi$counts))\n\nNow we are all set to start our analysis!\n\nNext Lesson",
    "crumbs": [
      "Day 1:",
      "Set up and overview for gene-level differential expression analysis"
    ]
  }
]